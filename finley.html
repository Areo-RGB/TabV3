<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.1.1
* @link https://tabler.io
* Copyright 2018-2025 The Tabler Authors
* Copyright 2018-2025 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Quo-Vadis</title>
    <link rel="icon" type="image/png" href="./h03-logo.png">
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="./dist/css/tabler.min.css?1740918423" rel="stylesheet" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PLUGINS STYLES -->
    <link href="./dist/css/tabler-flags.min.css?1740918423" rel="stylesheet" />
    <link href="./dist/css/tabler-socials.min.css?1740918423" rel="stylesheet" />
    <link href="./dist/css/tabler-payments.min.css?1740918423" rel="stylesheet" />
    <link href="./dist/css/tabler-vendors.min.css?1740918423" rel="stylesheet" />
    <link href="./dist/css/tabler-marketing.min.css?1740918423" rel="stylesheet" />
    <!-- END PLUGINS STYLES -->
    <!-- BEGIN DEMO STYLES -->
    <link href="./preview/css/demo.min.css?1740918423" rel="stylesheet" />
    <!-- END DEMO STYLES -->
    <!-- BEGIN CUSTOM STYLES -->
    <style>
      /* Reset and Base Styles */
      body {
        background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%);
        font-family: 'Inter', sans-serif;
        color: #e0e7ff;
        overflow-x: hidden;
        margin: 0;
      }

      /* HUD Overlay */
      .hud-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        background: rgba(13, 27, 42, 0.5);
      }

      /* Clickable table rows */
      #kpi-table-body tr {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      #kpi-table-body tr:hover {
        background-color: rgba(69, 162, 255, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      #kpi-table-body tr.active {
        background-color: rgba(69, 162, 255, 0.2);
        border-left: 3px solid #45a2ff;
      }

      /* Chart animations */
      .chart-card {
        /* display: none; - Handled by chart-container now */
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
        background: rgba(27, 38, 59, 0.9); /* Moved background here */
        border: 1px solid rgba(69, 162, 255, 0.3); /* Moved border here */
      }

      .chart-card.active {
        /* display: block; - Handled by chart-container now */
        opacity: 1;
        transform: translateY(0);
      }

      /* Highlight effect */
      @keyframes highlight-pulse {
        0% { box-shadow: 0 0 0 0 rgba(69, 162, 255, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(69, 162, 255, 0); }
        100% { box-shadow: 0 0 0 0 rgba(69, 162, 255, 0); }
      }

      .pulse-highlight {
        animation: highlight-pulse 1.5s ease-out;
      }

      .scan-lines {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 50%, transparent 50%);
        background-size: 100% 4px;
        animation: scan 10s linear infinite;
      }

      .noise {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.05;
        background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAAXNSR0IArs4c6QAAAEZQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBB4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAHGlET1QAAAACAAAAAAAAABMAAAAoAAAAEwAAABMAAADXa6TfAAAAVUlEQVQ4y+3SSQ4AIAwDwQ8C/f9vdkkZAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAMk/YB48oD5uAAAAAElFTkSuQmCC');
      }

      @keyframes scan {
        0% { transform: translateY(0); }
        100% { transform: translateY(-100%); }
      }

      /* Cards */
      .card {
        background: rgba(27, 38, 59, 0.85);
        border: 1px solid rgba(69, 162, 255, 0.3);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 0 10px rgba(69, 162, 255, 0.1);
        backdrop-filter: blur(8px);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(69, 162, 255, 0.2);
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 10% 10%, rgba(69, 162, 255, 0.2), transparent 50%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .card:hover::before {
        opacity: 1;
      }

      /* All cards including hero use the same background */
      .page-body .row:first-child .card .subheader {
        color: rgba(224, 231, 255, 0.8);
      }

      /* KPI Cards */
      #kpi-container .card {
        background: rgba(27, 38, 59, 0.9);
        border: 1px solid rgba(132, 99, 255, 0.3);
      }

      #kpi-container .card-title {
        color: #e0e7ff;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      #kpi-container .text-secondary {
        color: rgba(224, 231, 255, 0.7) !important;
      }

      /* Badges */
      .badge[class*="-lt"] {
        font-weight: normal;
        font-size: 0.81em; /* Increased font size again by 25% */
        padding: 0.45em 0.81em; /* Increased padding again by 25% */
        border-radius: 4px; /* Kept border-radius */
      }

      /* Custom badge colors */
      .badge.bg-success-lt {
        background-color: #198754 !important;
        color: white !important;
      }

      .badge.bg-orange-lt {
        background-color: #fd7e14 !important;
        color: black !important;
      }

      .badge.bg-danger-lt {
        background-color: #dc3545 !important;
        color: white !important;
      }

      /* Navbar */
      .navbar {
        background: rgba(13, 27, 42, 0.9);
        border-bottom: 1px solid rgba(69, 162, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      .nav-link {
        color: #e0e7ff !important;
        transition: color 0.3s ease, transform 0.3s ease;
      }

      .nav-link:hover {
        color: #45a2ff !important;
        transform: scale(1.1);
      }

      .nav-item.active .nav-link {
        color: #45a2ff !important;
        font-weight: 700;
        position: relative;
      }

      .nav-item.active .nav-link::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background: #45a2ff;
        box-shadow: 0 0 5px #45a2ff;
      }

      /* Dropdown Menu - Comprehensive Fix */
      .dropdown-menu {
        z-index: 9999 !important;
        position: absolute !important;
        background: rgba(27, 38, 59, 0.95);
        border: 1px solid rgba(69, 162, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        transform: none !important;
        top: 100% !important;
        left: 0 !important;
        will-change: auto !important;
        margin-top: 0.5rem !important;
      }

      .dropdown-item {
        color: #e0e7ff;
        position: relative;
        z-index: 10000;
      }

      .dropdown-item:hover, .dropdown-item:focus {
        background: rgba(69, 162, 255, 0.2);
        color: #45a2ff;
      }

      .dropdown-item.active {
        background: rgba(69, 162, 255, 0.3);
        color: #45a2ff;
        font-weight: 600;
      }

      /* Fix for dropdown being covered by other elements */
      .navbar-nav .nav-item.dropdown {
        position: relative !important;
        z-index: 9999 !important;
      }

      /* Fix for hero section potentially overlapping */
      .page-body {
        position: relative;
        z-index: 1;
      }

      /* Ensure navbar has higher z-index than page content */
      .navbar,
      .navbar-collapse,
      .navbar-expand-md {
        position: relative;
        z-index: 9999 !important;
      }

      /* Charts */
      /* #charts-container .card was removed as style is now on .chart-card */

      .apexcharts-text,
      .apexcharts-title-text,
      .apexcharts-legend-text,
      .apexcharts-xaxis-label,
      .apexcharts-yaxis-label {
        fill: #e0e7ff !important;
        font-family: 'Inter', sans-serif !important;
      }

      .apexcharts-gridline,
      .apexcharts-xaxis-tick {
        stroke: rgba(69, 162, 255, 0.2) !important;
      }

      /* Footer */
      .footer {
        background: rgba(13, 27, 42, 0.8);
        border-top: 1px solid rgba(69, 162, 255, 0.2);
      }

      .footer a {
        color: #45a2ff;
        transition: color 0.3s ease;
      }

      .footer a:hover {
        color: #84a6ff;
      }

      /* Modal */
      .modal-content {
        background: rgba(27, 38, 59, 0.95);
        border: 1px solid rgba(69, 162, 255, 0.3);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      }

      .modal-header,
      .modal-footer {
        border-color: rgba(69, 162, 255, 0.2);
      }

      .modal-title,
      .form-label {
        color: #e0e7ff;
      }

      /* Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .card,
      .nav-link {
        animation: fadeIn 0.5s ease-out forwards;
      }

      .card:nth-child(1) { animation-delay: 0.1s; }
      .card:nth-child(2) { animation-delay: 0.2s; }
      .card:nth-child(3) { animation-delay: 0.3s; }
      .card:nth-child(4) { animation-delay: 0.4s; }
      .card:nth-child(5) { animation-delay: 0.5s; }
      .card:nth-child(6) { animation-delay: 0.6s; }

      /* Loader */
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .chart-loader {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .chart-loader div {
        width: 40px;
        height: 40px;
        border: 4px solid #45a2ff;
        border-top: 4px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Ripple Effect */
      .ripple {
        position: absolute;
        background: rgba(69, 162, 255, 0.3);
        border-radius: 50%;
        transform: scale(0);
        animation: ripple 0.6s linear;
        pointer-events: none;
      }

      @keyframes ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }

      /* Font Import */
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    </style>
    <!-- END CUSTOM STYLES -->
  </head>
  <body>
    <!-- HUD Overlay -->
    <div class="hud-overlay">
      <div class="scan-lines"></div>
      <div class="noise"></div>
    </div>
    <!-- BEGIN DEMO THEME SCRIPT -->
    <script src="./preview/js/demo-theme.min.js?1740918423"></script>
    <!-- END DEMO THEME SCRIPT -->
    <div class="page">
      <!-- BEGIN NAVBAR -->
      <header class="navbar navbar-expand-md d-print-none">
        <div class="container-xl">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="navbar-nav flex-row order-md-last">
            <div class="d-none d-md-flex">
              <a href="#" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom" id="darkModeToggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
                </svg>
              </a>
              <a href="#" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom" id="lightModeToggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <circle cx="12" cy="12" r="4" />
                  <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
                </svg>
              </a>
            </div>
          </div>
        </div>
      </header>
      <header class="navbar-expand-md">
        <div class="collapse navbar-collapse" id="navbar-menu">
          <div class="navbar">
            <div class="container-xl">
              <div class="row flex-fill align-items-center">
                <div class="col">
                  <ul class="navbar-nav">
                    <li class="nav-item">
                      <a class="nav-link" href="./uebersicht.html">
                        <span class="nav-link-icon d-md-none d-lg-inline-block">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12L12 3L21 12V20C21 21.1 20.1 22 19 22H5C3.9 22 3 21.1 3 20V12Z"/>
                            <path d="M9 22V14H15V22"/>
                          </svg>
                        </span>
                        <span class="nav-link-title"> Übersicht </span>
                      </a>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="false">
                        <span class="nav-link-icon d-md-none d-lg-inline-block">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-1">
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                          </svg>
                        </span>
                        <span class="nav-link-title"> Spieler </span>
                      </a>
                      <div class="dropdown-menu">
                        <a class="dropdown-item active" href="./finley.html">
                          Finley
                        </a>
                        <a class="dropdown-item" href="./bent.html">
                          Bent
                        </a>
                        <a class="dropdown-item" href="./ben.html">
                          Ben
                        </a>
                        <a class="dropdown-item" href="./alex.html">
                          Alex
                        </a>
                        <a class="dropdown-item" href="./lion.html">
                          Lion
                        </a>
                      </div>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="./daten.html">
                        <span class="nav-link-icon d-md-none d-lg-inline-block">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-1">
                            <path d="M4 7v-1a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-1" />
                            <path d="M7 9l4 -4l4 4" />
                            <path d="M12 5l0 9" />
                            <path d="M7 14l4 4l4 -4" />
                          </svg>
                        </span>
                        <span class="nav-link-title"> Daten </span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- END NAVBAR -->
      <div class="page-wrapper">
        <!-- BEGIN PAGE HEADER -->
        <div class="page-header d-print-none py-2">
          <div class="container-xl">
            <div class="row align-items-center">
              <div class="col">
                <h2 class="page-title mb-0"></h2>
              </div>
            </div>
          </div>
        </div>
        <!-- END PAGE HEADER -->
        <!-- BEGIN PAGE BODY -->
        <div class="page-body">
          <div class="container-xl">
            <!-- BEGIN HERO SECTION WITH PORTRAIT AND GESAMTBEWERTUNG -->
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-body py-4">
                    <div class="row align-items-center">
                      <div class="col-auto d-flex justify-content-center">
                        <img src="./static/photos/Finley_portrait.png" alt="Finley Portrait" class="rounded-circle" width="120" height="120">
                      </div>
                      <div class="col">
                        <div class="text-center">
                          <h2 class="mb-1">Finley</h2>
                          <h3 class="subheader mb-2">Gesamtbewertung</h3>
                          <div class="d-flex flex-column align-items-center justify-content-center">
                            <div class="h1 mb-3" style="font-size: 3rem; font-weight: 600;" id="average-percentile">76</div>
                            <span class="badge bg-orange-lt" id="average-label">Durchschnittlich</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- KPI Cards Row -->
                    <div class="row mt-4">
                      <!-- KPI Card 1 - Badge Style -->
                      <div class="col-md-4">
                        <div class="card" style="background: linear-gradient(135deg, #3b82f6 0%, #94a3b8 100%);">
                          <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                              <h4 class="m-0" style="color: white; font-weight: 600;">Technik</h4>
                              <span class="badge rounded-pill" style="background-color: rgba(255, 255, 255, 0.25); backdrop-filter: blur(4px); color: white; font-weight: 600; padding: 6px 12px;">
                                <a href="finley.html" style="color: white; text-decoration: none;"><i class="ti-crown me-1"></i> Top 15%</a>
                              </span>
                            </div>
                            <div class="text-center my-2">
                              <span style="color: white; font-size: 32px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">7.81s</span>
                            </div>
                            <div class="d-flex mt-2">
                              <div class="flex-fill text-center" style="border-right: 1px solid rgba(255,255,255,0.2);">
                                <small style="color: rgba(255,255,255,0.7);">Dribbling</small>
                                <div style="color: white; font-weight: 600;">8.66s</div>
                              </div>
                              <div class="flex-fill text-center" style="border-right: 1px solid rgba(255,255,255,0.2);">
                                <small style="color: rgba(255,255,255,0.7);">Ballkontrolle</small>
                                <div style="color: white; font-weight: 600;">+12%</div>
                              </div>
                              <div class="flex-fill text-center">
                                <small style="color: rgba(255,255,255,0.7);">Illinois-Test</small>
                                <div style="color: white; font-weight: 600;">15.2s</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- KPI Card 2 - Badge Style -->
                      <div class="col-md-4">
                        <div class="card" style="background: linear-gradient(135deg, #4b5563 0%, #1e3a8a 100%);">
                          <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                              <h4 class="m-0" style="color: white; font-weight: 600;">Athletik</h4>
                              <span class="badge rounded-pill" style="background-color: rgba(255, 255, 255, 0.25); backdrop-filter: blur(4px); color: white; font-weight: 600; padding: 6px 12px;">
                                <i class="ti-bolt me-1"></i> Top 10%
                              </span>
                            </div>
                            <div class="text-center my-2">
                              <span style="color: white; font-size: 32px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">2.00s</span>
                            </div>
                            <div class="d-flex mt-2">
                              <div class="flex-fill text-center" style="border-right: 1px solid rgba(255,255,255,0.2);">
                                <small style="color: rgba(255,255,255,0.7);">Durchschnitt</small>
                                <div style="color: white; font-weight: 600;">2.18s</div>
                              </div>
                              <div class="flex-fill text-center">
                                <small style="color: rgba(255,255,255,0.7);">Ballkontrolle</small>
                                <div style="color: white; font-weight: 600;">+8%</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- KPI Card 3 - Badge Style -->
                      <div class="col-md-4">
                        <div class="card" style="background: linear-gradient(135deg, #64748b 0%, #0f172a 100%);">
                          <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                              <h4 class="m-0" style="color: white; font-weight: 600;">Koordination</h4>
                              <span class="badge rounded-pill" style="background-color: rgba(255, 255, 255, 0.25); backdrop-filter: blur(4px); color: white; font-weight: 600; padding: 6px 12px;">
                                <i class="ti-target me-1"></i> Top 30%
                              </span>
                            </div>
                            <div class="text-center my-2">
                              <span style="color: white; font-size: 32px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">10.27s</span>
                            </div>
                            <div class="d-flex mt-2">
                              <div class="flex-fill text-center" style="border-right: 1px solid rgba(255,255,255,0.2);">
                                <small style="color: rgba(255,255,255,0.7);">Durchschnitt</small>
                                <div style="color: white; font-weight: 600;">11.36s</div>
                              </div>
                              <div class="flex-fill text-center">
                                <small style="color: rgba(255,255,255,0.7);">Verbesserung</small>
                                <div style="color: white; font-weight: 600;">+9%</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- END HERO SECTION -->
            <!-- DFB Benchmark KPIs Section Header -->
            <div class="row mb-4">
              <div class="col">
                <div class="card">
                  <div class="card-header" id="leistungsdiagnostik-header" style="cursor: pointer; position: relative; z-index: 100;">
                    <div class="d-flex align-items-center justify-content-between w-100"> <!-- Added w-100 here -->
                      <div class="d-flex align-items-center">
                        <img src="https://upload.wikimedia.org/wikipedia/de/c/c0/DFB-Logo.svg" alt="DFB Logo" style="height: 30px; margin-right: 15px;">
                        <h3 class="card-title m-0">Technomotorische Leistungsdiagnostik</h3>
                      </div>
                      <div id="toggle-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <polyline points="6 9 12 15 18 9" />
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div id="leistungsdiagnostik-content" style="display: none;">
                    <div class="card-body p-0" id="combined-kpi-container">
                      <!-- Combined KPIs table will be injected here -->
                    </div>
                    <!-- ADDED: Container for charts inside the collapsible area -->
                    <div id="leistungsdiagnostik-charts-container" class="row row-cards mt-4 p-3">
                        <!-- Charts will be injected here by JS -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <script>
              // Direct DOM manipulation toggle implementation
              document.addEventListener('DOMContentLoaded', function() {
                // Get the elements by their specific IDs to avoid conflicts
                const header = document.getElementById('leistungsdiagnostik-header');
                const content = document.getElementById('leistungsdiagnostik-content');
                const icon = document.getElementById('toggle-icon').querySelector('svg');

                // Make absolutely sure content is hidden initially
                content.style.display = 'none';

                // Ensure the header is clickable by checking and removing any Bootstrap data attributes
                if (header.hasAttribute('data-bs-toggle')) {
                  header.removeAttribute('data-bs-toggle');
                }

                // Click handler for the header with direct DOM manipulation
                header.addEventListener('click', function(event) {
                  // Prevent any default or bubbling behavior
                  event.preventDefault();
                  event.stopPropagation();

                  // Simple toggle with direct style manipulation
                  if (content.style.display === 'none') {
                    content.style.display = 'block';
                    icon.style.transform = 'rotate(180deg)';
                    icon.style.transition = 'transform 0.3s ease';
                  } else {
                    content.style.display = 'none';
                    icon.style.transform = 'rotate(0deg)';
                    icon.style.transition = 'transform 0.3s ease';
                  }
                });

                // Ensure this section runs by logging to console
                console.log('Collapsible section initialized');
              });
            </script>
            <div id="kpi-container" style="display: none;">
              <!-- Original KPI container hidden but kept for script compatibility -->
            </div>            <!-- Motorik Metrics - Hidden -->
            <div class="row mb-3" style="display: none;">
              <div class="col">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center">
                      <img src="./static/photos/MoMo_ohneTxt_700px.png" alt="MoMo Logo" style="height: 30px; margin-right: 15px;">
                      <h3 class="card-title">Motorik</h3>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row row-cards mb-4" id="other-kpi-container" style="display: none;">
              <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <h3 class="card-title mb-1">Standweitsprung</h3>
                  <p class="text-secondary mb-1">Result: 164 cm</p>
                  <p class="text-secondary mb-1">Kategorie: Kraft</p>
                  <p class="text-secondary mb-0"></p> <!-- No rank string as DFB data is missing -->
                  <div class="mt-2 text-start"><span class="badge bg-orange-lt">Durchschnittlich</span></div>
                </div>
              </div>
            </div><div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <h3 class="card-title mb-1">Einbeinstand</h3>
                  <p class="text-secondary mb-1">Result: 8 Fehler</p>
                  <p class="text-secondary mb-1">Kategorie: Gleichgewicht</p>
                  <p class="text-secondary mb-0"></p> <!-- No rank string -->
                  <div class="mt-2 text-start"><span class="badge bg-danger-lt">unterdurchschnittlich</span></div>
                </div>
              </div>
            </div><div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <h3 class="card-title mb-1">Springseil</h3>
                  <p class="text-secondary mb-1">Result: 82</p>
                  <p class="text-secondary mb-1">Kategorie: Koordination</p>
                  <p class="text-secondary mb-0"></p> <!-- No rank string -->
                  <div class="mt-2 text-start"><span class="badge bg-success-lt">Ausgezeichnet</span></div>
                </div>
              </div>
            </div>
            </div>

            <!-- Deutsches Sportabzeichen Section Header - Hidden -->
            <div class="row mb-3" style="display: none;">
              <div class="col">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center">
                      <img src="./static/photos/dosb.png" alt="Deutsches Sportabzeichen Logo" style="height: 30px; margin-right: 15px;">
                      <h3 class="card-title">Deutsches Sportabzeichen</h3>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row row-cards mb-4" id="sportabzeichen-kpi-container" style="display: none;">
              <div class="col-md-4 mb-3">
                <div class="card">
                  <div class="card-body">
                    <h3 class="card-title mb-1">50m Sprint</h3>
                    <p class="text-secondary mb-1">Result: 8.86s</p>
                    <p class="text-secondary mb-0"></p> <!-- No category or rank string needed -->
                    <div class="mt-2 text-start"><span class="badge bg-secondary-lt">Silber</span></div>
                  </div>
                </div>
              </div><div class="col-md-4 mb-3">
                <div class="card">
                  <div class="card-body">
                    <h3 class="card-title mb-1">800m Lauf</h3>
                    <p class="text-secondary mb-1">Result: 3:30s</p>
                    <p class="text-secondary mb-0"></p> <!-- No category or rank string needed -->
                    <div class="mt-2 text-start"><span class="badge" style="background: gold !important; color: #333 !important;">Gold</span></div>
                  </div>
                </div>
              </div><div class="col-md-4 mb-3">
                <div class="card">
                  <div class="card-body">
                    <h3 class="card-title mb-1">Standweitsprung</h3>
                    <p class="text-secondary mb-1">Result: 164cm</p>
                    <p class="text-secondary mb-0"></p> <!-- No category or rank string needed -->
                    <div class="mt-2 text-start"><span class="badge bg-secondary-lt">Silber</span></div>
                  </div>
                </div>
              </div><div class="col-md-4 mb-3">
                <div class="card">
                  <div class="card-body">
                    <h3 class="card-title mb-1">Springseil</h3>
                    <p class="text-secondary mb-1">Result: 92</p>
                    <p class="text-secondary mb-0"></p> <!-- No category or rank string needed -->
                    <div class="mt-2 text-start"><span class="badge" style="background: gold !important; color: #333 !important;">Gold</span></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- REMOVED: Original Charts Section container -->
            <!--
            <div class="row row-cards" id="charts-container">
            -->
              <!-- Charts injected here -->
            <!--
            </div>
            -->
          </div>
        </div>
        <!-- END PAGE BODY -->
        <!-- BEGIN FOOTER -->

        <!-- END FOOTER -->
      </div>
    </div>
    <!-- BEGIN PAGE MODALS -->
    <div class="modal modal-blur fade" id="modal-report" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">New report</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" name="example-text-input" placeholder="Your report name" />
            </div>
            <label class="form-label">Report type</label>
            <div class="form-selectgroup-boxes row mb-3">
              <div class="col-lg-6">
                <label class="form-selectgroup-item">
                  <input type="radio" name="report-type" value="1" class="form-selectgroup-input" checked />
                  <span class="form-selectgroup-label d-flex align-items-center p-3">
                    <span class="me-3">
                      <span class="form-selectgroup-check"></span>
                    </span>
                    <span class="form-selectgroup-label-content">
                      <span class="form-selectgroup-title strong mb-1">Simple</span>
                      <span class="d-block text-secondary">Provide only basic data needed for the report</span>
                    </span>
                  </span>
                </label>
              </div>
              <div class="col-lg-6">
                <label class="form-selectgroup-item">
                  <input type="radio" name="report-type" value="1" class="form-selectgroup-input" />
                  <span class="form-selectgroup-label d-flex align-items-center p-3">
                    <span class="me-3">
                      <span class="form-selectgroup-check"></span>
                    </span>
                    <span class="form-selectgroup-label-content">
                      <span class="form-selectgroup-title strong mb-1">Advanced</span>
                      <span class="d-block text-secondary">Insert charts and additional advanced analyses to be inserted in the report</span>
                    </span>
                  </span>
                </label>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-8">
                <div class="mb-3">
                  <label class="form-label">Report url</label>
                  <div class="input-group input-group-flat">
                    <span class="input-group-text"> https://tabler.io/reports/ </span>
                    <input type="text" class="form-control ps-0" value="report-01" autocomplete="off" />
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="mb-3">
                  <label class="form-label">Visibility</label>
                  <select class="form-select">
                    <option value="1" selected>Private</option>
                    <option value="2">Public</option>
                    <option value="3">Hidden</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Client name</label>
                  <input type="text" class="form-control" />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Reporting period</label>
                  <input type="date" class="form-control" />
                </div>
              </div>
              <div class="col-lg-12">
                <div>
                  <label class="form-label">Additional information</label>
                  <textarea class="form-control" rows="3"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <a href="#" class="btn btn-link link-secondary btn-3" data-bs-dismiss="modal"> Cancel </a>
            <a href="#" class="btn btn-primary btn-5 ms-auto" data-bs-dismiss="modal">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-2">
                <path d="M12 5l0 14" />
                <path d="M5 12l14 0" />
              </svg>
              Create new report
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- END PAGE MODALS -->
    <!-- BEGIN PAGE LIBRARIES -->
    <script src="./libs/apexcharts/dist/apexcharts.min.js?1740918423" defer></script>
    <script src="./libs/jsvectormap/dist/jsvectormap.min.js?1740918423" defer></script>
    <script src="./libs/jsvectormap/dist/maps/world.js?1740918423" defer></script>
    <script src="./libs/jsvectormap/dist/maps/world-merc.js?1740918423" defer></script>
    <!-- END PAGE LIBRARIES -->
    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="./dist/js/tabler.min.js?1740918423" defer></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->
    <!-- BEGIN DEMO SCRIPTS -->
    <script src="./preview/js/demo.min.js?1740918423" defer></script>
    <!-- END DEMO SCRIPTS -->
    <!-- BEGIN PAGE SCRIPTS -->
    <script>
      // @formatter:off
      document.addEventListener("DOMContentLoaded", function () {
        // Player data for comparisons
        const playerComparisonData = [
          { player: "Finley", exercise: "10m Sprint", result: 2.00 },
          { player: "Finley", exercise: "20m Sprint", result: 3.59 },
          { player: "Finley", exercise: "Gewandtheit", result: 7.81 },
          { player: "Finley", exercise: "Dribbling", result: 10.27 },
          { player: "Finley", exercise: "Balljonglieren", result: 0.00 },
          { player: "Finley", exercise: "Ballkontrolle", result: 10.82 },
          { player: "Finley", exercise: "YoYo IR1", result: 640 },

          { player: "Alex", exercise: "10m Sprint", result: 2.16 },
          { player: "Alex", exercise: "20m Sprint", result: 3.78 },
          { player: "Alex", exercise: "Gewandtheit", result: 7.39 },
          { player: "Alex", exercise: "Dribbling", result: 10.00 },
          { player: "Alex", exercise: "Ballkontrolle", result: 8.92 },
          { player: "Alex", exercise: "YoYo IR1", result: 1720 },

          { player: "Bent", exercise: "10m Sprint", result: 2.19 },
          { player: "Bent", exercise: "20m Sprint", result: 3.82 },
          { player: "Bent", exercise: "Gewandtheit", result: 8.14 },
          { player: "Bent", exercise: "Dribbling", result: 10.28 },
          { player: "Bent", exercise: "Ballkontrolle", result: 8.95 },
          { player: "Bent", exercise: "Balljonglieren", result: 3 }
        ];

        // Helper function to get player result for specific exercise
        function getPlayerResult(playerName, exerciseName) {
          const playerData = playerComparisonData.find(item =>
            item.player === playerName && item.exercise === exerciseName);
          return playerData ? playerData.result : null;
        }

        // Helper function to calculate numeric percentile value
        function getNumericPercentile(percentileStr) {
          if (!percentileStr) return 0;
          if (percentileStr.startsWith('>')) {
            return parseFloat(percentileStr.substring(1).replace('%',''));
          } else if (percentileStr.startsWith('<')) {
            return 0;
          } else {
            return parseFloat(percentileStr.replace('%',''));
          }
        }

        // Helper function to calculate percentile rank
        function calculatePercentileRank(finleyResult, dfbValues, dfbCategories, exerciseName) {
          if (finleyResult === null || finleyResult === undefined) {
            return { rankString: 'No result available', label: '', numericPercentile: 0 };
          }
          if (!dfbValues || dfbValues.length === 0 || !dfbCategories || dfbCategories.length === 0 || dfbValues.length !== dfbCategories.length) {
            const resultDisplay = finleyResult !== undefined && finleyResult !== null ? finleyResult : 'N/A';
            return { rankString: 'Ranking data not available', label: '', resultDisplay: resultDisplay, numericPercentile: 0 };
          }

          const higherIsBetter = ['YoYo IR1', 'Balljonglieren'].includes(exerciseName);
          let percentile = '<' + dfbCategories[0];
          let foundRank = false;

          for (let i = dfbCategories.length - 1; i >= 0; i--) {
            const dfbValue = dfbValues[i];
            const dfbPercentile = dfbCategories[i];
            if (higherIsBetter) {
              if (finleyResult >= dfbValue) {
                percentile = dfbPercentile;
                foundRank = true;
                break;
              }
            } else {
              if (finleyResult <= dfbValue) {
                percentile = dfbPercentile;
                foundRank = true;
                break;
              }
            }
          }

          if (foundRank) {
            const bestDfbValue = dfbValues[dfbValues.length - 1];
            const bestDfbPercentile = dfbCategories[dfbCategories.length - 1];
            if (higherIsBetter && finleyResult > bestDfbValue) {
              percentile = '>' + bestDfbPercentile;
            } else if (!higherIsBetter && finleyResult < bestDfbValue) {
              percentile = '>' + bestDfbPercentile;
            }
          }

          let rankString = '';
          let label = '';
          let numericPercentile = 0;

          if (percentile.startsWith('>')) {
            numericPercentile = parseFloat(percentile.substring(1).replace('%',''));
            rankString = `Better than ${numericPercentile}% of players`;
          } else if (percentile.startsWith('<')) {
            numericPercentile = 0;
            rankString = `Below the ${dfbCategories[0]} percentile`;
          } else {
            numericPercentile = parseFloat(percentile.replace('%',''));
            rankString = `Better than ${numericPercentile}% of players`;
          }

          if (numericPercentile >= 97) {
            label = 'Ausgezeichnet';
          } else if (numericPercentile >= 90) {
            label = 'Sehr gut';
          } else if (numericPercentile >= 80) {
            label = 'Gut';
          } else if (numericPercentile >= 30) {
            label = 'Durchschnittlich';
          } else if (percentile.startsWith('<') || numericPercentile < 30) {
            label = 'Unterdurchschnittlich';
          }

          return { rankString, label, numericPercentile };
        }

        // Function to calculate average percentile
        function calculateAveragePercentile(chartData) {
          const exercisesToInclude = ['10m Sprint', '20m Sprint', 'Gewandtheit', 'Dribbling', 'Balljonglieren', 'Ballkontrolle'];
          let totalPercentile = 0;
          let countedExercises = 0;

          chartData.forEach(data => {
            if (exercisesToInclude.includes(data.exercise) &&
                data.finleyResult !== null && data.finleyResult !== undefined &&
                data.dfbValues && data.dfbValues.length > 0 && data.dfbCategories && data.dfbCategories.length > 0) {
              const rankInfo = calculatePercentileRank(data.finleyResult, data.dfbValues, data.dfbCategories, data.exercise);
              totalPercentile += rankInfo.numericPercentile;
              countedExercises++;
            }
          });

          if (countedExercises > 0) {
            const avgPercentile = totalPercentile / countedExercises;
            return {
              average: avgPercentile.toFixed(1),
              label: getPercentileLabel(avgPercentile)
            };
          }
          return { average: 0, label: 'Insufficient Data' };
        }

        // Helper to get label based on percentile
        function getPercentileLabel(percentile) {
          if (percentile >= 97) return 'Ausgezeichnet';
          if (percentile >= 90) return 'Sehr gut';
          if (percentile >= 80) return 'Gut';
          if (percentile >= 30) return 'Durchschnittlich';
          return 'Unterdurchschnittlich';
        }

        // Chart data
        const chartData = [
          {
            exercise: "10m Sprint",
            finleyResult: 2.00,
            dfbCategories: ['10%', '20%', '30%', '40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [2.33, 2.28, 2.24, 2.21, 2.18, 2.16, 2.13, 2.10, 2.05, 1.99]
          },
          {
            exercise: "20m Sprint",
            finleyResult: 3.59,
            dfbCategories: ['3%', '10%', '20%', '30%', '40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [4.14, 4.01, 3.93, 3.87, 3.82, 3.78, 3.74, 3.69, 3.64, 3.57, 3.47]
          },
          {
            exercise: "Gewandtheit",
            finleyResult: 7.81,
            dfbCategories: ['3%', '10%', '20%', '30%', '40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [9.66, 9.33, 9.07, 8.90, 8.77, 8.66, 8.54, 8.42, 8.28, 8.11, 7.91]
          },
          {
            exercise: "Dribbling",
            finleyResult: 10.27,
            dfbCategories: ['3%', '10%', '20%', '30%', '40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [14.37, 13.42, 12.84, 12.50, 12.15, 11.90, 11.68, 11.44, 11.16, 10.84, 10.43]
          },
          {
            exercise: "Balljonglieren",
            finleyResult: 0.00,
            dfbCategories: ['40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [1.00, 1.00, 1.00, 1.00, 2.00, 3.00, 6.00]
          },
          {
            exercise: "Ballkontrolle",
            finleyResult: 10.82,
            dfbCategories: ['3%', '10%', '20%', '30%', '40%', '50%', '60%', '70%', '80%', '90%', '97%'],
            dfbValues: [15.29, 13.81, 12.86, 12.28, 11.78, 11.36, 10.99, 10.59, 10.18, 9.66, 9.00]
          },
          {
            exercise: "YoYo IR1",
            finleyResult: 640,
            dfbCategories: [],
            dfbValues: []
          }
        ];

        const kpiContainer = document.getElementById('kpi-container');
        // Get the NEW container for charts inside the Leistungsdiagnostik card
        const leistungsdiagnostikChartsContainer = document.getElementById('leistungsdiagnostik-charts-container');


        // Calculate average percentile
        const averagePercentileInfo = calculateAveragePercentile(chartData);          // Update Gesamtbewertung
        const averagePercentileElement = document.getElementById('average-percentile');
        const averageLabelElement = document.getElementById('average-label');

        if (averagePercentileElement) {
          averagePercentileElement.textContent = Math.ceil(parseFloat(averagePercentileInfo.average));

          // Color the percentile number based on performance tier
          if (averagePercentileInfo.label === 'Ausgezeichnet') {
            averagePercentileElement.style.color = '#6610f2'; // Purple
            averagePercentileElement.style.textShadow = '0 0 10px rgba(102, 16, 242, 0.4)';
          } else if (averagePercentileInfo.label === 'Sehr gut') {
            averagePercentileElement.style.color = '#20c997'; // Teal
            averagePercentileElement.style.textShadow = '0 0 10px rgba(32, 201, 151, 0.4)';
          } else if (averagePercentileInfo.label === 'Gut') {
            averagePercentileElement.style.color = '#0dcaf0'; // Cyan
            averagePercentileElement.style.textShadow = '0 0 10px rgba(13, 202, 240, 0.4)';
          } else if (averagePercentileInfo.label === 'Durchschnittlich') {
            averagePercentileElement.style.color = '#fd7e14'; // Orange
            averagePercentileElement.style.textShadow = '0 0 10px rgba(253, 126, 20, 0.4)';
          } else if (averagePercentileInfo.label === 'Unterdurchschnittlich') {
            averagePercentileElement.style.color = '#dc3545'; // Red
            averagePercentileElement.style.textShadow = '0 0 10px rgba(220, 53, 69, 0.4)';
          }
        }

        if (averageLabelElement) {
          // Custom badge styling based on performance tier
          averageLabelElement.textContent = averagePercentileInfo.label;

          if (averagePercentileInfo.label === 'Ausgezeichnet') {
            averageLabelElement.className = 'badge';
            averageLabelElement.style.background = 'linear-gradient(90deg, #6f42c1 0%, #6610f2 100%)';
            averageLabelElement.style.color = '#fff';
            averageLabelElement.style.boxShadow = '0 0 15px rgba(102, 16, 242, 0.5)';
          } else if (averagePercentileInfo.label === 'Sehr gut') {
            averageLabelElement.className = 'badge';
            averageLabelElement.style.background = 'linear-gradient(90deg, #20c997 0%, #198754 100%)';
            averageLabelElement.style.color = '#fff';
            averageLabelElement.style.boxShadow = '0 0 15px rgba(32, 201, 151, 0.5)';
          } else if (averagePercentileInfo.label === 'Gut') {
            averageLabelElement.className = 'badge';
            averageLabelElement.style.background = 'linear-gradient(90deg, #0dcaf0 0%, #0d6efd 100%)';
            averageLabelElement.style.color = '#fff';
            averageLabelElement.style.boxShadow = '0 0 15px rgba(13, 202, 240, 0.5)';
          } else if (averagePercentileInfo.label === 'Durchschnittlich') {
            averageLabelElement.className = 'badge';
            averageLabelElement.style.background = 'linear-gradient(90deg, #fd7e14 0%, #ffc107 100%)';
            averageLabelElement.style.color = '#343a40';
            averageLabelElement.style.boxShadow = '0 0 15px rgba(253, 126, 20, 0.5)';
          } else if (averagePercentileInfo.label === 'Unterdurchschnittlich') {
            averageLabelElement.className = 'badge';
            averageLabelElement.style.background = 'linear-gradient(90deg, #dc3545 0%, #f56565 100%)';
            averageLabelElement.style.color = '#fff';
            averageLabelElement.style.boxShadow = '0 0 15px rgba(220, 53, 69, 0.5)';
          }

          // Add more visual appeal to the badge
          averageLabelElement.style.fontWeight = '600';
          averageLabelElement.style.padding = '0.5em 1.2em';
          averageLabelElement.style.borderRadius = '10px';
          averageLabelElement.style.letterSpacing = '0.5px';
          averageLabelElement.style.fontSize = '1rem';
          averageLabelElement.style.transform = 'translateY(0)';
          averageLabelElement.style.transition = 'all 0.3s ease';
        }

        // Create the combined KPI table
        const combinedKpiContainer = document.getElementById('combined-kpi-container');
        // Create a table element
        const kpiTable = document.createElement('table');
        kpiTable.className = 'table table-vcenter table-hover card-table';
        kpiTable.innerHTML = `
          <thead>
            <tr>
              <th>Übung</th>
              <th>Ergebnis</th>
              <th>Bewertung</th>
              <th>Benchmark</th>
              <th>Ranking</th>
            </tr>
          </thead>
          <tbody id="kpi-table-body">
          </tbody>
        `;
        combinedKpiContainer.appendChild(kpiTable);
        const kpiTableBody = document.getElementById('kpi-table-body');

        // Loop through each data point and create a table row and chart div
        chartData.filter(data => data.exercise !== "YoYo IR1").forEach((data, index) => {
          const chartId = `chart-exercise-${index}`;
          const kpiId = `kpi-exercise-${index}`;

          // Calculate rank and label
          let rankInfo;
          let labelHtml = '';
          rankInfo = calculatePercentileRank(data.finleyResult, data.dfbValues, data.dfbCategories, data.exercise);
          if (rankInfo.label) {
            let badgeColor = 'secondary';
            if (rankInfo.label === 'Gut') badgeColor = 'success';
            if (rankInfo.label === 'Sehr gut') badgeColor = 'success';
            if (rankInfo.label === 'Ausgezeichnet') badgeColor = 'success';
            if (rankInfo.label === 'Durchschnittlich') badgeColor = 'orange';
            if (rankInfo.label === 'Unterdurchschnittlich') badgeColor = 'danger';
            labelHtml = `<span class="badge bg-${badgeColor}-lt">${rankInfo.label}</span>`;
          }

          // Format the result display
          const resultDisplay = data.exercise === 'YoYo IR1'
            ? (data.finleyResult !== null && data.finleyResult !== undefined ? data.finleyResult + 'm' : 'N/A')
            : (data.finleyResult !== null && data.finleyResult !== undefined
              ? (data.exercise === 'Balljonglieren' ? Math.round(data.finleyResult) : data.finleyResult.toFixed(2) + 's')
              : 'N/A');

          // Create table row
          const row = document.createElement('tr');
          row.id = kpiId;

          // Create benchmark display
          let benchmarkDisplay = '';
          if (data.dfbValues && data.dfbValues.length > 0) {
            const topValue = data.dfbValues[data.dfbValues.length-1];
            const finleyValue = data.finleyResult;
            const higherIsBetter = ['Balljonglieren'].includes(data.exercise);

            if (finleyValue !== null && finleyValue !== undefined) {
              let percentDifference = 0;
              if (higherIsBetter) {
                percentDifference = finleyValue > 0 ? ((finleyValue - topValue) / topValue * 100) : -100;
              } else {
                percentDifference = ((topValue - finleyValue) / topValue * 100);
              }

              const percentText = percentDifference >= 0 ?
                `<span class="text-success" title="Abstand Topwert">+${percentDifference.toFixed(1)}%</span>` :
                `<span class="text-danger" title="Abstand Topwert">${percentDifference.toFixed(1)}%</span>`;

              benchmarkDisplay = percentText;
            } else {
              benchmarkDisplay = '<span class="text-muted">N/A</span>';
            }
          }

          // Get ranking text for the additional column
          let rankingText = '';
          if (rankInfo.numericPercentile > 0) {
            rankingText = `<span class="text-muted">Better than ${rankInfo.numericPercentile}%</span>`; // Removed ' of players' for brevity
          } else if (rankInfo.rankString === 'Ranking data not available') {
             rankingText = '<span class="text-muted">N/A</span>';
          }
          else {
            rankingText = '<span class="text-muted">Below 10%</span>'; // Adjusted for cases below lowest percentile
          }

          row.innerHTML = `
            <td class="fw-bold">${data.exercise}</td>
            <td>${resultDisplay}</td>
            <td>${labelHtml}</td>
            <td>${benchmarkDisplay}</td>
            <td>${rankingText}</td>
          `;
          kpiTableBody.appendChild(row);

          // Also create hidden KPI Card for chart compatibility (optional, might remove if not used elsewhere)
          const kpiColDiv = document.createElement('div');
          kpiColDiv.className = 'col-md-4 mb-3';
          kpiColDiv.style.display = 'none';
          kpiColDiv.innerHTML = `
            <div class="card" id="${kpiId}-hidden">
              <div class="card-body">
                <h3 class="card-title mb-1">${data.exercise}</h3>
                <p class="text-secondary mb-1">Result: ${resultDisplay}</p>
                <p class="text-secondary mb-0">${rankInfo.rankString}</p>
                <div class="mt-2">${labelHtml}</div>
              </div>
            </div>
          `;
          kpiContainer.appendChild(kpiColDiv); // Keep appending to hidden container if needed

          // Create Chart Container (always create the container div now)
          const chartColDiv = document.createElement('div');
          // Use col-12 to make chart take full width within the card's content area
          chartColDiv.className = 'col-12 mb-4 chart-container';
          chartColDiv.dataset.exercise = data.exercise;
          chartColDiv.style.display = 'none'; // Hide initially
          chartColDiv.innerHTML = `
            <div class="card chart-card rounded"> <!-- Added rounded -->
              <div class="card-body">
                <div id="${chartId}"></div>
                <div class="chart-loader">
                  <div></div>
                </div>
              </div>
            </div>`;
          // Append the chart container to the NEW location inside the Leistungsdiagnostik card
          leistungsdiagnostikChartsContainer.appendChild(chartColDiv);


          // Create Chart Logic (skip for YoYo IR1)
          if (data.exercise !== "YoYo IR1") {
            if (data.finleyResult !== null && data.finleyResult !== undefined && data.dfbValues && data.dfbValues.length > 0 && data.dfbCategories && data.dfbCategories.length > 0) {

              const playerName = "Finley";
              let allValues = [];
              let allCategories = [];

              // Add Finley's result
              allValues.push(data.exercise === 'Balljonglieren' ? Math.round(data.finleyResult) : parseFloat(data.finleyResult.toFixed(2)));
              allCategories.push(playerName);

              // Add other players' results if available
              const alexResult = getPlayerResult("Alex", data.exercise);
              if (alexResult !== null) {
                allValues.push(data.exercise === 'Balljonglieren' ? Math.round(alexResult) : parseFloat(alexResult.toFixed(2)));
                allCategories.push("Alex");
              }

              const bentResult = getPlayerResult("Bent", data.exercise);
              if (bentResult !== null) {
                allValues.push(data.exercise === 'Balljonglieren' ? Math.round(bentResult) : parseFloat(bentResult.toFixed(2)));
                allCategories.push("Bent");
              }

              // Add DFB benchmarks
              data.dfbValues.forEach((value, index) => {
                allValues.push(data.exercise === 'Balljonglieren' ? Math.round(value) : parseFloat(value.toFixed(2)));
                allCategories.push("DFB " + data.dfbCategories[index]);
              });

              const higherIsBetter = ['Balljonglieren'].includes(data.exercise);
              const combinedData = allValues.map((value, index) => {
                return { value: value, category: allCategories[index] };
              });
              combinedData.sort((a, b) => higherIsBetter ? b.value - a.value : a.value - b.value);
              const playerIndex = combinedData.findIndex(item => item.category === playerName);
              allValues = combinedData.map(item => item.value);
              allCategories = combinedData.map(item => item.category);

              const options = {
                chart: {
                  type: 'bar',
                  height: 350,
                  toolbar: { show: true },
                  zoom: { enabled: false },
                  animations: {
                    enabled: true,
                    easing: 'easeinout',
                    speed: 800
                  }
                },
                plotOptions: {
                  bar: {
                    horizontal: true,
                    dataLabels: {
                      position: 'top'
                    }
                  }
                },
                series: [
                  {
                    name: 'Results',
                    data: allValues,
                    color: function(opts) {
                      const category = allCategories[opts.dataPointIndex];
                      if (category === "Finley") return '#45a2ff'; // Finley - Blue
                      if (category === "Alex") return '#20c997';   // Alex - Teal
                      if (category === "Bent") return '#fd7e14';   // Bent - Orange
                      if (category.startsWith("DFB")) return '#6c757d'; // DFB - Gray
                      return '#6c757d'; // Default
                    }
                  }
                ],
                xaxis: {
                  categories: allCategories,
                  title: { text: 'Performance Results', style: { color: '#e0e7ff', fontFamily: 'Inter' } }, // Changed font
                  min: 0,
                  // max: Math.max(...allValues) * 1.1, // Let apex auto-determine max for better spacing
                  labels: { style: { colors: '#e0e7ff', fontFamily: 'Inter' } } // Changed font
                },
                yaxis: {
                  title: {
                    text: data.exercise === 'Balljonglieren' ? 'Count' : 'Time (s)',
                    style: { color: '#e0e7ff', fontFamily: 'Inter' } // Changed font
                  },
                  reversed: false,
                  opposite: false,
                  labels: {
                    align: 'left',
                    style: { colors: '#e0e7ff', fontFamily: 'Inter' } // Changed font
                  }
                },
                title: {
                  text: data.exercise,
                  align: 'center',
                  style: { color: '#e0e7ff', fontFamily: 'Inter', fontWeight: 600 } // Changed font
                },
                dataLabels: {
                  enabled: true,
                  formatter: function (val) {
                    return data.exercise === 'Balljonglieren' ? Math.round(val) : val.toFixed(2);
                  },
                  offsetX: -30,
                  style: {
                    colors: ['#e0e7ff'],
                    fontSize: '13px',
                    fontWeight: 700,
                    fontFamily: 'Inter' // Changed font
                  }
                },
                tooltip: {
                  theme: 'dark',
                  x: { formatter: val => data.exercise === 'Balljonglieren' ? Math.round(val) : val.toFixed(2) }
                },
                legend: {
                  position: 'top',
                  horizontalAlign: 'right',
                  floating: true,
                  offsetY: -25,
                  offsetX: -5,
                  labels: { colors: '#e0e7ff', fontFamily: 'Inter' } // Changed font
                },
                grid: {
                  borderColor: 'rgba(69, 162, 255, 0.2)'
                }
              };

              // Show loader briefly
              const loader = chartColDiv.querySelector('.chart-loader');
              loader.style.display = 'block';
              setTimeout(() => {
                loader.style.display = 'none';
                if (window.ApexCharts) {
                  // Ensure the target element exists before rendering
                  const chartElement = document.querySelector(`#${chartId}`);
                   if (chartElement) {
                       new ApexCharts(chartElement, options).render();
                   } else {
                       console.error(`Chart element #${chartId} not found.`);
                   }
                } else {
                  console.error("ApexCharts library not loaded.");
                  document.querySelector(`#${chartId}`).innerHTML = '<p class="text-center text-danger">Error: Chart library not loaded.</p>';
                }
              }, 500);
            } else {
              // Handle cases where chart cannot be generated (missing data) inside the created container
              const chartElement = chartColDiv.querySelector(`#${chartId}`);
               if (chartElement) {
                    chartElement.innerHTML = `
                        <h5 class="card-title text-center pt-5 pb-5" style="color: #e0e7ff;">${data.exercise}</h5>
                        <p class="text-center mt-3" style="color: rgba(224, 231, 255, 0.8);">Chart not available due to missing data.</p>
                    `;
                }
            }
          } else {
             // Handle YoYo IR1 specifically if needed (e.g., display text)
             const chartElement = chartColDiv.querySelector(`#${chartId}`);
             if (chartElement) {
                  chartElement.innerHTML = `
                      <h5 class="card-title text-center pt-5 pb-5" style="color: #e0e7ff;">${data.exercise}</h5>
                      <p class="text-center mt-3" style="color: rgba(224, 231, 255, 0.8);">No comparison chart available for this exercise.</p>
                  `;
              }
          }
        });


        // REMOVED: Original demo chart removal logic - no longer needed as they are not in the template now.

        // Theme toggling
        const darkModeToggle = document.getElementById('darkModeToggle');
        const lightModeToggle = document.getElementById('lightModeToggle');

        function setTheme(themeName) {
          document.body.setAttribute('data-bs-theme', themeName);
          localStorage.setItem('tabler-theme', themeName);
        }

        function initTheme() {
          const savedTheme = localStorage.getItem('tabler-theme');
          if (savedTheme) {
            setTheme(savedTheme);
          } else {
            setTheme('dark'); // Default to dark
          }
        }

        if (darkModeToggle) {
          darkModeToggle.addEventListener('click', function(e) {
            e.preventDefault();
            setTheme('dark');
          });
        }

        if (lightModeToggle) {
          lightModeToggle.addEventListener('click', function(e) {
            e.preventDefault();
            setTheme('light');
          });
        }

        initTheme();

        // Add click event listeners to table rows to show corresponding charts
        document.querySelectorAll('#kpi-table-body tr').forEach(row => {
          row.addEventListener('click', function() {
            // Get the exercise name from the first cell
            const exerciseName = this.querySelector('td:first-child').textContent;

            // Remove active class from all rows
            document.querySelectorAll('#kpi-table-body tr').forEach(r =>
              r.classList.remove('active'));

            // Add active class to clicked row
            this.classList.add('active');

            // Hide all charts within the Leistungsdiagnostik container
            leistungsdiagnostikChartsContainer.querySelectorAll('.chart-container').forEach(chartContainer => {
              chartContainer.style.display = 'none';
              const chartCard = chartContainer.querySelector('.chart-card');
               if (chartCard) {
                   chartCard.classList.remove('active');
               }
            });

            // Find and show corresponding chart
            const chartContainer = leistungsdiagnostikChartsContainer.querySelector(`.chart-container[data-exercise="${exerciseName}"]`);
            if (chartContainer) {
              // Add pulse highlight effect
              chartContainer.classList.add('pulse-highlight');
              setTimeout(() => {
                chartContainer.classList.remove('pulse-highlight');
              }, 1500);

              // Show the chart container
              chartContainer.style.display = 'block';
              const chartCard = chartContainer.querySelector('.chart-card');
              if (chartCard) {
                setTimeout(() => chartCard.classList.add('active'), 50); // Add delay for animation

                // Scroll to the chart if it's not in view *relative to the viewport*
                const cardHeader = document.getElementById('leistungsdiagnostik-header');
                const cardHeaderRect = cardHeader.getBoundingClientRect();
                const chartRect = chartContainer.getBoundingClientRect();
                const viewportHeight = window.innerHeight;

                // Check if top is above header or bottom is below viewport
                const isTopAboveHeader = chartRect.top < cardHeaderRect.bottom;
                const isBottomBelowViewport = chartRect.bottom > viewportHeight;

                if (isTopAboveHeader || isBottomBelowViewport) {
                     // Scroll chart container into view, aligning top just below the header
                     chartContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                     // Adjust scroll slightly to account for header height if needed after scroll finishes
                     setTimeout(() => {
                        const currentHeaderRect = cardHeader.getBoundingClientRect();
                        const currentChartRect = chartContainer.getBoundingClientRect();
                        if (currentChartRect.top < currentHeaderRect.bottom + 10) { // 10px buffer
                            window.scrollBy(0, currentChartRect.top - currentHeaderRect.bottom - 10);
                        }
                     }, 400); // Adjust delay based on smooth scroll duration
                }
              }
            } else {
                 console.log(`Chart container for exercise "${exerciseName}" not found.`);
            }
          });
        });

        // Show first chart by default if the content area is visible
        const contentArea = document.getElementById('leistungsdiagnostik-content');
        const firstRow = document.querySelector('#kpi-table-body tr');
        if (firstRow && contentArea.style.display !== 'none') {
            setTimeout(() => firstRow.click(), 500); // Delay ensures chart renders after initial setup
        } else if (firstRow) {
            // If content area is initially hidden, add listener to trigger click on expand
            const header = document.getElementById('leistungsdiagnostik-header');
            header.addEventListener('click', function expandListener() {
                // Check if expanding and if first row hasn't been clicked yet
                if (contentArea.style.display === 'block' && !firstRow.classList.contains('active')) {
                     setTimeout(() => firstRow.click(), 100); // Short delay after expand animation
                }
                // Optional: Remove listener after first expand if needed, though not strictly necessary here
                // header.removeEventListener('click', expandListener);
            }, { once: false }); // Listen multiple times if needed
        }


        // Ripple effect for cards
        document.querySelectorAll('.card').forEach(card => {
          card.addEventListener('click', function(e) {
            // Prevent ripple on header click causing collapse/expand
            if (e.target.closest('#leistungsdiagnostik-header')) return;
            // Prevent ripple on table row click
            if (e.target.closest('#kpi-table-body tr')) return;

            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            const rect = card.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = `${size}px`;
            ripple.style.left = `${e.clientX - rect.left - size / 2}px`;
            ripple.style.top = `${e.clientY - rect.top - size / 2}px`;

            // Ensure ripple is appended to the card itself, not children
            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
          });
        });
      });
      // @formatter:on
    </script>
    <!-- END PAGE SCRIPTS -->
  </body>
</html>